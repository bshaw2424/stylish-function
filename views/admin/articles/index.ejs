<%- include ../../partials/header %> <%- include ../../admin/mobile-nav %>
<section class="index-container">
  <%- include ../../admin/admin-nav %>
  <div class="container">
    <div class="title-container">
      <h1>Articles</h1>
    </div>
    <div class="filter-search">
      <input
        type="text"
        name="filter-search"
        id="filter-search"
        class="browser-default"
        placeholder="filter search"
      />
      <a href="/admin/articles/new" class="btn go-button">Create New Article</a>
    </div>
    <div class="article-container">
      <div class="row">
        <div class="display-message hide">Article Not Found!</div>
        <% for(const article of articles) { %>
        <div class="col s12 m6 l4 xl4">
          <div class="card">
            <div class="card-image admin-card-image">
              <img src="<%= article.image.url %>" alt="<%= article.image %>" />
              <div class="overlay-icon">
                <a
                  href="/admin/articles/<%= article.slug %>/photo-edit"
                  class="btn"
                  >update photo</a
                >
              </div>
            </div>
            <div class="card-content">
              <a href="/admin/articles/<%= article.slug %>" class="card-title">
                <%= article.title %>
              </a>
              <p><%= article.description %></p>
              <div class="button-container">
                <a
                  href="/admin/articles/<%= article.slug %>/edit"
                  class="btn go-button"
                  >Edit</a
                >
                <form
                  action="/admin/articles/<%= article.slug %>?_method=DELETE"
                  method="POST"
                >
                  <button class="btn delete-button">delete</button>
                </form>
              </div>
            </div>
          </div>
        </div>
        <% } %>
      </div>
    </div>
  </div>
</section>
<%- include ../../partials/footer %>

<script>
  const filterInput = document.querySelector(".filter-search #filter-search");
  const cardTitles = document.querySelectorAll(".card-content .card-title");
  const card = document.querySelectorAll(".article-container .col");
  const filterMessage = document.querySelector(".display-message");

  filterInput.addEventListener("input", e => {
    // get all the card titles for their respective card parent
    const titles = Array.from(cardTitles).slice();
    // the parent card column
    const cards = Array.from(card).slice();
    // get input value / set to lowercase
    const targetValue = e.target.value.toLowerCase().trim();

    for (let i = 0; i < cardTitles.length; i++) {
      const card_title = cardTitles[i].innerText.toLowerCase();
      console.log(card_title, targetValue);
      if (card_title.includes(targetValue)) {
        cards[i].style.display = "";
        filterMessage.classList.add("hide");
      } else {
        cards[i].style.display = "none";
        filterMessage.classList.remove("hide");
      }
    }
  });
</script>
